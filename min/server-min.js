var express=require("express"),mongoose=require("mongoose"),fs=require("fs"),app=express(),host="127.0.0.1";mongoose.connect("mongodb://localhost/btpMinor");var io=require("socket.io")(app.listen(3e3)),btpData,db=mongoose.connection;db.on("error",console.error.bind(console,"connection error:")),db.once("open",function e(){var e;console.log("connected"),e=mongoose.Schema({cent:Array,num:Number,time:{type:Date,"default":Date.now}});var o=mongoose.model("btpData",e);io.on("connection",function(e){var n;fs.watch("public/js/data",function(r,t){fs.readFile("public/js/data/"+t,function(r,t){if(void 0!==t&&!r){var s=JSON.parse(t);s&&(n=new o({cent:s.cent,num:s.num}),n.save(function(e,o){e&&console.log("error in saving")}),console.log(s),e.emit("updated",s))}})})})}),app.use(express.static(__dirname+"/public")),app.get("/",function(e,o){o.sendfile("/index.html")});